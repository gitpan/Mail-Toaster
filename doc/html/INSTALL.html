<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Mail::Toaster Install</title>
<link rev="made" href="mailto:root@hampsten.nonet" />
</head>

<body style="background-color: white">

<p><a name="__index__"></a></p>
<!-- INDEX BEGIN -->

<ul>

	<li><a href="#step_1__install_perl_">Step 1: Install Perl.</a></li>
	<li><a href="#step_2__install_mail__toaster">Step 2: Install Mail::Toaster</a></li>
	<li><a href="#step_3__edit_config_files">Step 3: Edit config files</a></li>
	<li><a href="#step_4__start_building_the_toaster_">Step 4: Start building the toaster!</a></li>
	<li><a href="#step_5__install_qmail">Step 5: Install Qmail</a></li>
	<li><a href="#step_6__install_web_pop3_imap_servers">Step 6: Install Web/POP3/IMAP servers</a></li>
	<li><a href="#step_7__configure_courierimap__optional_">Step 7: Configure Courier-IMAP (optional)</a></li>
	<li><a href="#step_8__set_up_mail_filtering_and_logging">Step 8: Set up mail filtering and logging</a></li>
	<li><a href="#step_9__add_cron_entries">Step 9: Add cron entries</a></li>
	<li><a href="#step_10__test_and_configure_">Step 10: Test and Configure.</a></li>
</ul>
<!-- INDEX END -->

<hr />
<p>
</p>
<h1><a name="step_1__install_perl_">Step 1: Install Perl.</a></h1>
<p>If you do not have perl installed, you need to install it. On FreeBSD 5, it's as easy as:</p>
<pre>
  pkg_add -r perl</pre>
<p>Certain programs (like spam assassin) require perl 5.8.1 or higher to function fully. If perl -v reflects anything smaller than 5.6.1, you must update it. If you intend to use qmail-scanner, perl must be suid enabled.  In Perl 5.8+, suid perl is not enabled by default. Enable suidperl by adding -DENABLE_SUIDPERL to your make command (as shown below):</p>
<pre>
  cd /usr/ports/lang/perl5.8;
  make -DENABLE_SUIDPERL install clean;
  rehash; use.perl port;</pre>
<p>If you are or will be upgrading perl on FreeBSD and using pkg* and friends (like portupgrade), add the following line to the MAKE_ARGS section of /usr/local/etc/pkgtools.conf:</p>
<pre>
 'lang/perl5.8' =&gt; 'ENABLE_SUIDPERL=yes',</pre>
<p>You may need Perl's CPAN working for installing perl modules so make sure it's configured. You can test by running:  perl -MCPAN -e shell . If that command doesn't give you a shell prompt, then you'll be prompted to configure. When you get to a prompt, the command ``exit'' will get you back out.</p>
<p>
</p>
<hr />
<h1><a name="step_2__install_mail__toaster">Step 2: Install Mail::Toaster</a></h1>
<p><a href="http://www.tnpi.biz/internet/mail/toaster/Mail-Toaster.tar.gz">http://www.tnpi.biz/internet/mail/toaster/Mail-Toaster.tar.gz</a></p>
<pre>
   perl Makefile.PL
   make install
   make newconf (overwrites installed .conf files)
   make cgi</pre>
<p>Documentation for the modules being called by toaster_setup.pl, toaster_watcher.pl, maillogs, and index.cgi are all installed in Perl's pod format (perldoc Mail::Toaster) as well as being available online at <a href="http://www.tnpi.biz/internet/mail/toaster/.">http://www.tnpi.biz/internet/mail/toaster/.</a></p>
<p>If you run ``make test'', you will likely get prompted to install any missing perl modules such as DBI and DBD::mysql. When prompted, choose no. The modules will get installed later.</p>
<p>
</p>
<hr />
<h1><a name="step_3__edit_config_files">Step 3: Edit config files</a></h1>
<pre>
   vi /usr/local/etc/toaster.conf
   vi /usr/local/etc/toaster-watcher.conf</pre>
<p>Edit to suit your preferences. Use 'perldoc toaster.conf' or 'perldoc toaster-watcher.conf' to read the man pages describing what all them settings are for.</p>
<p>
</p>
<hr />
<h1><a name="step_4__start_building_the_toaster_">Step 4: Start building the toaster!</a></h1>
<pre>
   rehash
   toaster_setup.pl -s pre
   toaster_setup.pl -s ports
   toaster_setup.pl -s mattbundle (optional)
   toaster_setup.pl -s mysql
   toaster_setup.pl -s apache
   toaster_setup.pl -s phpmyadmin (optional)
   toaster_setup.pl -s ucspi
   toaster_setup.pl -s ezmlm 
   toaster_setup.pl -s vpopmail
   toaster_setup.pl -s maildrop
   toaster_setup.pl -s qmailadmin</pre>
<p>NOTICE: The default install method is now ports (instead of packages). You can alter this in toaster-watcher.conf. This default was changed due to compatibility problems with some packages on FreeBSD's servers (notable MySQL and SNMPd). The flip side is that it's typical that at least one of the thousands of FreeBSD ports is broken. When you find a port that won't compile, try installing the package (ie. ``pkg_add -r expat'' ) instead.</p>
<p>If toaster_setup.pl has any problems running, fix what it complains about and then run it again. It will pick up where it left off.</p>
<p>If you want something installed ``your'' way, install it yourself. Toaster_setup.pl will detect it (assuming it's registered in the package database) and skip that portion of the install. Just don't act surprised when a toaster advertised feature doesn't work.</p>
<p>
</p>
<hr />
<h1><a name="step_5__install_qmail">Step 5: Install Qmail</a></h1>
<pre>
   toaster_setup.pl -s qmail</pre>
<p>patch info: <a href="http://www.tnpi.biz/internet/mail/toaster/patches/">http://www.tnpi.biz/internet/mail/toaster/patches/</a></p>
<p>
</p>
<hr />
<h1><a name="step_6__install_web_pop3_imap_servers">Step 6: Install Web/POP3/IMAP servers</a></h1>
<pre>
   toaster_setup.pl -s courier
   toaster_setup.pl -s sqwebmail
   toaster_setup.pl -s squirrelmail</pre>
<p>
</p>
<hr />
<h1><a name="step_7__configure_courierimap__optional_">Step 7: Configure Courier-IMAP (optional)</a></h1>
<p>Courier includes some generic settings in it's SSL config files (*d.conf). If you edit those files, you can have your own values reflected in your SSL certificates that are used the IMAP-SSL and POP3-SSL servers.</p>
<pre>
   cd /usr/local/etc/courier-imap
   vi pop3d.cnf imapd.cnf quotawarnmsg
   cd /usr/local/share/courier-imap
   ./mkimapdcert; ./mkpop3dcert</pre>
<p>
</p>
<hr />
<h1><a name="step_8__set_up_mail_filtering_and_logging">Step 8: Set up mail filtering and logging</a></h1>
<pre>
   toaster_setup.pl -s filter</pre>
<p>You can safely skip this step. However, all the spiffy anti-virus and spam detection software will not work. If this is your first mail toaster, you may even want to skip this step, get everything working to your satisfaction and then add in the mail filtering.  It can be daunting for the faint of heart.</p>
<pre>
   toaster_setup.pl -s maillogs
   toaster_setup.pl -s supervise
   toaster_setup.pl -s rrdutil (optional)
   toaster_setup.pl -s qss (optional)</pre>
<p>
</p>
<hr />
<h1><a name="step_9__add_cron_entries">Step 9: Add cron entries</a></h1>
<p>Run all these commands from the command line and verify their proper functionality (no complaints or errors) BEFORE adding to cron.</p>
<pre>
 crontab -u root -e 
 9-59/10 * * * * /usr/local/vpopmail/bin/clearopensmtp
 40  * * * *  /usr/local/share/sqwebmail/cleancache.pl
 */5 * * * * /usr/local/sbin/toaster-watcher.pl
 */5 * * * * /usr/local/www/cgi-bin/rrdutil.cgi -a update</pre>
<p>
</p>
<hr />
<h1><a name="step_10__test_and_configure_">Step 10: Test and Configure.</a></h1>
<p>The following command runs a battery of tests.</p>
<pre>
   toaster_setup.pl -s test</pre>
<p>It's output is quite verbose so you may want to pipe it's output through grep and look for any ``FAILED'' lines. If you have any, then you'll need to pay some attention to that area.</p>
<p>Visit this URL: <a href="http://www.tnpi.biz/internet/mail/toaster/config.shtml">http://www.tnpi.biz/internet/mail/toaster/config.shtml</a> Skipping this step is guaranteed to make you less than pleased with your toaster.</p>
<p>See <a href="http://mail.cadillac.net/">http://mail.cadillac.net/</a> for an example of index.cgi.</p>

</body>

</html>
