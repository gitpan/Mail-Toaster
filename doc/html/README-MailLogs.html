<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Mail::Toaster::Logs README</title>
<link rev="made" href="mailto:root@hampsten.nonet" />
</head>

<body style="background-color: white">

<p><a name="__index__"></a></p>
<!-- INDEX BEGIN -->

<ul>

	<li><a href="#name">NAME</a></li>
	<li><a href="#synopsis">SYNOPSIS</a></li>
	<li><a href="#description">DESCRIPTION</a></li>
	<ul>

		<li><a href="#what_am_i">what_am_i</a></li>
	</ul>

	<li><a href="#installation">INSTALLATION</a></li>
	<li><a href="#dependencies">DEPENDENCIES</a></li>
	<li><a href="#design_considerations">Design considerations</a></li>
	<li><a href="#author">AUTHOR</a></li>
	<li><a href="#bugs">BUGS</a></li>
	<li><a href="#see_also">SEE ALSO</a></li>
	<li><a href="#copyright">COPYRIGHT</a></li>
</ul>
<!-- INDEX END -->

<hr />
<p>
</p>
<h1><a name="name">NAME</a></h1>
<p>Mail::Logs - A log file processer for mail server logs</p>
<p>
</p>
<hr />
<h1><a name="synopsis">SYNOPSIS</a></h1>
<p>A script that maintains ever increasing counters for mail logs and functions as a postprocessor for multilog. Currently handles log counting of the following types:</p>
<pre>
        qmail mail delivery (send)
        qmail-pop3d         (pop3) (edit file to set pop3 daemon)</pre>
<pre>
        courier pop3d       (pop3) (edit file to set pop3 daemon)
        courier pop3dssl    (pop3)
        courier imapd       (imap)
        courier imapdssl    (imap)</pre>
<pre>
        vpopmail smtp-auth  (smtp)</pre>
<pre>
        sqwebmail           (webmail)
        squirrelmail        (webmail)</pre>
<pre>
        rblsmtpd            (rbl)</pre>
<pre>
        spamasssassin       (spamassassin)
        qmailscanner        (qmailscanner)</pre>
<p>This script and modules is (at last) easily extendible as I continue to find new stats on my mail system that I want to count and graph.</p>
<p>
</p>
<hr />
<h1><a name="description">DESCRIPTION</a></h1>
<p>I have ``farms'' of mail servers that share a hostname. I needed 
a way to collect the logs from all the servers and process them.</p>
<p>This is a piece of that puzzle. Maillogs does several things. First,
it acts as a simple log postprocessor. By default it takes files that
qmail outputs (/var/log/mail/[send|smtp|pop3]/current) and collects 
a bunch of counters about the logs and stores them in counter files.</p>
<p>For smtp logs we count denied RBL connections (rblsmtpd).</p>
<p>For qmail-send we log a slew of message send statistics.</p>
<p>For pop3, IMAP, webmail, and SMTP-AUTH, we count  the number of 
connections and the number of successful logins.</p>
<p>Counters are written to files in /var/log/mail/counters/ by default.
You can alter the locations of the logs files by editing the 
toaster.conf file included with this script. That file should be
installed in /usr/local/etc.</p>
<p>
</p>
<h2><a name="what_am_i">what_am_i</a></h2>
<p>what_am_i - Is this a schizophrenic program?</p>
<p>No, because schizophrenic denotes a disorder. This application is designed
to behave differently depending on how it's called. It has (currently) four
 distinct personalities. Allow me to introduce you to multilog.</p>
<p>The multilog program (http://cr.yp.to/daemontools/multilog.html)
has a poorly documented ability to run a postprocessor on logs
after they reach a predetermined size (or are otherwise triggered).</p>
<p>This script is designed to be that postprocessor. If you rename this file to
be named one of ``smtplog'', ``pop3log'', or ``sendlog'' it will become a log
file processor for that qmail server protocol. See the maillogs FAQ for 
more details.</p>
<p>If called as maillogs, it will return ever incrementing counters for the 
protocol you entered. Run maillogs without any parameters to see the supported
options. It's expected that you'll be calling maillogs from an SNMP agent 
allowing this solution to scale from single to clustered systems.</p>
<p>
</p>
<hr />
<h1><a name="installation">INSTALLATION</a></h1>
<p>To install this module type the following:</p>
<pre>
        perl Makefile.PL
        make
        make test
        make install</pre>
<p>To install as a post-processor for qmail type the following:</p>
<pre>
        make qmail</pre>
<p>
</p>
<hr />
<h1><a name="dependencies">DEPENDENCIES</a></h1>
<p>This program requires these other modules and libraries:</p>
<p>Mail::Toaster - <a href="http://www.tnpi.biz/computing/mail/toaster/">http://www.tnpi.biz/computing/mail/toaster/</a></p>
<p>
</p>
<hr />
<h1><a name="design_considerations">Design considerations</a></h1>
<ul>
<li><strong><a name="item_counters_will_be_polled_via_snmp_2e_script_must_be">Counters will be polled via SNMP. Script must be able to return counts instantly, even when dealing with HUGE logs.</a></strong><br />
</li>
<li><strong><a name="item_must_work_with_multilog_and_syslog_logging_formats">Must work with multilog and syslog logging formats</a></strong><br />
</li>
<li><strong><a name="item_outputs_data_in_a_format_suitable_for_polling_via_">Outputs data in a format suitable for polling via SNMP</a></strong><br />
</li>
<li><strong><a name="item_simple_configuration">Simple configuration</a></strong><br />
</li>
<li><strong><a name="item_fail_safe_2c_errors_must_be_noticed_and_reported_b">Fail safe, errors must be noticed and reported but not fatal</a></strong><br />
</li>
</ul>
<p>
</p>
<hr />
<h1><a name="author">AUTHOR</a></h1>
<p>Matt Simerson &lt;<a href="mailto:matt@tnpi.biz">matt@tnpi.biz</a>&gt;</p>
<p>
</p>
<hr />
<h1><a name="bugs">BUGS</a></h1>
<p>None known. Report any to author.</p>
<p>
</p>
<hr />
<h1><a name="see_also">SEE ALSO</a></h1>
<p><a href="http://www.tnpi.biz/internet/mail/">http://www.tnpi.biz/internet/mail/</a></p>
<p>
</p>
<hr />
<h1><a name="copyright">COPYRIGHT</a></h1>
<p>Copyright (c) 2004, The Network People, Inc.
All rights reserved.</p>
<p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</p>
<p>Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</p>
<p>Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</p>
<p>Neither the name of the The Network People, Inc. nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</p>
<p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>

</body>

</html>
