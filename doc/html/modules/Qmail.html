<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Mail::Toaster::Qmail</title>
<link rev="made" href="mailto:root@hampsten.nonet" />
</head>

<body style="background-color: white">

<p><a name="__index__"></a></p>
<!-- INDEX BEGIN -->

<ul>

	<li><a href="#name">NAME</a></li>
	<li><a href="#synopsis">SYNOPSIS</a></li>
	<li><a href="#description">DESCRIPTION</a></li>
	<ul>

		<li><a href="#getlistofrwls">GetListOfRWLs</a></li>
		<li><a href="#testeachrbl">TestEachRBL</a></li>
		<li><a href="#getlistofrbls">GetListOfRBLs</a></li>
		<li><a href="#buildsendrun">BuildSendRun</a></li>
		<li><a href="#buildpop3run">BuildPOP3Run</a></li>
		<li><a href="#testsmtpdconfigvalues">TestSmtpdConfigValues</a></li>
		<li><a href="#setservicedir">SetServiceDir</a></li>
		<li><a href="#buildsmtprun">BuildSmtpRun</a></li>
		<li><a href="#buildsubmitrun">BuildSubmitRun</a></li>
		<li><a href="#installqmailservicerun">InstallQmailServiceRun</a></li>
		<li><a href="#restartqmailsmtpd">RestartQmailSmtpd</a></li>
		<li><a href="#stopqmailsend">StopQmailSend</a></li>
		<li><a href="#startqmailsend">StartQmailSend</a></li>
		<li><a href="#processqmailqueue">ProcessQmailQueue</a></li>
		<li><a href="#checkrcpthosts">CheckRcpthosts</a></li>
		<li><a href="#configqmail">ConfigQmail</a></li>
		<li><a href="#configureqmailcontrol">ConfigureQmailControl</a></li>
		<li><a href="#installqmailsuperviserunfiles">InstallQmailSuperviseRunFiles</a></li>
		<li><a href="#installqmailsuperviselogrunfiles">InstallQmailSuperviseLogRunFiles</a></li>
		<li><a href="#getdomainsfromassign">GetDomainsFromAssign</a></li>
	</ul>

	<li><a href="#author">AUTHOR</a></li>
	<li><a href="#bugs">BUGS</a></li>
	<li><a href="#todo">TODO</a></li>
	<li><a href="#see_also">SEE ALSO</a></li>
	<li><a href="#copyright">COPYRIGHT</a></li>
</ul>
<!-- INDEX END -->

<hr />
<p>
</p>
<h1><a name="name">NAME</a></h1>
<p>Mail::Toaster:::Qmail - Common Qmail functions</p>
<p>
</p>
<hr />
<h1><a name="synopsis">SYNOPSIS</a></h1>
<p>Mail::Toaster::Qmail is frequently used functions I've written for perl use with Qmail.</p>
<p>
</p>
<hr />
<h1><a name="description">DESCRIPTION</a></h1>
<p>This module has all sorts of goodies, the most useful of which are the Build????Run modules which build your qmail control files for you.</p>
<p>
</p>
<h2><a name="getlistofrwls">GetListOfRWLs</a></h2>
<pre>
        use Mail::Toaster::Qmail
        my $list = GetListOfRWLs($conf, $debug);</pre>
<p>Here we collect a list of the RWLs from the configuration file that get's passed to us. We return an arrayref with a list of the enabled ones.</p>
<p>
</p>
<h2><a name="testeachrbl">TestEachRBL</a></h2>
<pre>
        use Mail::Toaster::Qmail
        my $list = TestEachRBL($arrayref, $debug);</pre>
<p>We get a list of RBL's in an arrayref and we run some tests on them to determine if they are working correctly. We return a list of the correctly functioning RBLs.</p>
<p>
</p>
<h2><a name="getlistofrbls">GetListOfRBLs</a></h2>
<pre>
        use Mail::Toaster::Qmail
        my $list = GetListOfRBLs($arrayref, $debug);</pre>
<p>We get passwd a configuration file (toaster-watcher.conf) and from it we extract all the RBL's the user has selected and return them as an array ref.</p>
<p>
</p>
<h2><a name="buildsendrun">BuildSendRun</a></h2>
<pre>
        use Mail::Toaster::Qmail;
        if ( BuildSendRun($conf, $file, $debug) ) { print &quot;success&quot;};</pre>
<p>BuildSendRun generates a supervise run file for qmail-send. $file is the location of the file it's going to generate. $conf is a list of configuration variables pulled from a config file (see ParseConfigfile). I typically use it like this:</p>
<pre>
        my $file = &quot;/tmp/toaster-watcher-send-runfile&quot;;
        if ( BuildSendRun($conf, $file ) )
        {
                InstallQmailServiceRun($file, &quot;$supervise/send/run&quot;);
        };</pre>
<p>If it succeeds in building the file, it will install it. You can optionally restart qmail after installing a new run file.</p>
<p>
</p>
<h2><a name="buildpop3run">BuildPOP3Run</a></h2>
<pre>
        use Mail::Toaster::Qmail;
        if ( BuildPOP3Run($conf, $file, $debug) ) { print &quot;success&quot;};</pre>
<p>Generate a supervise run file for qmail-pop3d. $file is the location of the file it's going to generate. $conf is a list of configuration variables pulled from a config file (see ParseConfigfile). I typically use it like this:</p>
<pre>
        my $file = &quot;/tmp/toaster-watcher-pop3-runfile&quot;;
        if ( BuildPOP3Run($conf, $file ) )
        {
                InstallQmailServiceRun($file, &quot;$supervise/pop3/run&quot;);
        };</pre>
<p>If it succeeds in building the file, it will install it. You can optionally restart the service after installing a new run file.</p>
<p>
</p>
<h2><a name="testsmtpdconfigvalues">TestSmtpdConfigValues</a></h2>
<p>
</p>
<h2><a name="setservicedir">SetServiceDir</a></h2>
<p>This is necessary because things such as service directories are now in /var by default but older versions of my toaster installed them in /. This will detect and adjust for that.</p>
<p>
</p>
<h2><a name="buildsmtprun">BuildSmtpRun</a></h2>
<pre>
        use Mail::Toaster::Qmail;
        if ( BuildSmtpRun($conf, $file, $debug) ) { print &quot;success&quot;};</pre>
<p>Generate a supervise run file for qmail-smtpd. $file is the location of the file it's going to generate. $conf is a list of configuration variables pulled from a config file (see ParseConfigfile). I typically use it like this:</p>
<pre>
        my $file = &quot;/tmp/toaster-watcher-smtpd-runfile&quot;;
        if ( BuildSmtpRun($conf, $file ) )
        {
                InstallQmailServiceRun($file, &quot;$supervise/smtp/run&quot;);
        };</pre>
<p>If it succeeds in building the file, it will install it. You can optionally restart the service after installing a new run file.</p>
<p>
</p>
<h2><a name="buildsubmitrun">BuildSubmitRun</a></h2>
<pre>
        use Mail::Toaster::Qmail;
        if ( BuildSubmitRun($conf, $file, $debug) ) { print &quot;success&quot;};</pre>
<p>Generate a supervise run file for qmail-smtpd running on submit. $file is the location of the file it's going to generate. $conf is a list of configuration variables pulled from a config file (see ParseConfigfile). I typically use it like this:</p>
<pre>
        my $file = &quot;/tmp/toaster-watcher-smtpd-runfile&quot;;
        if ( BuildSubmitRun($conf, $file ) )
        {
                InstallQmailServiceRun($file, &quot;$supervise/submit/run&quot;);
        };</pre>
<p>If it succeeds in building the file, it will install it. You can optionally restart the service after installing a new run file.</p>
<p>
</p>
<h2><a name="installqmailservicerun">InstallQmailServiceRun</a></h2>
<pre>
        use Mail::Toaster::Qmail;</pre>
<pre>
        my $file = &quot;/tmp/toaster-watcher-smtpd-runfile&quot;;
        if ( BuildSmtpRun($conf, $file ) )
        {
                InstallQmailServiceRun($file, &quot;$supervise/smtp/run&quot;);
        };</pre>
<p>The code says it as well as I can.</p>
<p>
</p>
<h2><a name="restartqmailsmtpd">RestartQmailSmtpd</a></h2>
<pre>
        RestartQmailSmtpd($dir, $debug)</pre>
<p>Use RestartQmailSmtpd to restart the qmail-smtpd process. It will send qmail-smtpd the TERM signal causing it to exit. It will restart immediately (supervise).</p>
<p>
</p>
<h2><a name="stopqmailsend">StopQmailSend</a></h2>
<pre>
        StopQmailSend</pre>
<p>Use StopQmailSend to quit the qmail-send process. It will send qmail-send the TERM signal and then wait until it's shut down before returning. If qmail-send fails to shut down within 100 seconds, then we force kill it, causing it to abort any outbound SMTP sessions that are active. This is safe, as qmail will attempt to deliver them again, and again until it succeeds.</p>
<p>
</p>
<h2><a name="startqmailsend">StartQmailSend</a></h2>
<pre>
        StartQmailSend - Start up the qmail-send process.</pre>
<p>After starting up qmail-send, we verify that it's running before returning.</p>
<p>
</p>
<h2><a name="processqmailqueue">ProcessQmailQueue</a></h2>
<pre>

ProcessQmailQueue - Tell qmail to process the queue immediately</pre>
<p>
</p>
<h2><a name="checkrcpthosts">CheckRcpthosts</a></h2>
<pre>
        use Mail::Toaster::Qmail;
        CheckRcpthosts($qmaildir);</pre>
<p>Checks the rcpthosts file and compare it to users/assign. Any zones that are in users/assign but not in control/rcpthosts or control/morercpthosts will be presented as a list and you'll be expected to add them to morercpthosts.</p>
<p>
</p>
<h2><a name="configqmail">ConfigQmail</a></h2>
<pre>
        use Mail::Toaster::Qmail;
        ConfigQmail($qmaildir, $host, $postmaster, $conf);</pre>
<p>Qmail is fantastic because it's so easy to configure. Just edit files and put the right values in them. However, many find that a problem because it's not so easy to always know the sytax for what goes in every file, and exactly where that file might be. This sub takes your values from toaster-watcher.conf and puts them where they need to be. It modifies the following files:</p>
<pre>
 /var/qmail/control/concurrencyremote
 /var/qmail/control/me
 /var/qmail/control/tarpitcount
 /var/qmail/control/tarpitdelay
 /var/qmail/control/sql
 /var/qmail/alias/.qmail-postmaster
 /var/qmail/alias/.qmail-root
 /var/qmail/alias/.qmail-mailer-daemon</pre>
<p>
</p>
<h2><a name="configureqmailcontrol">ConfigureQmailControl</a></h2>
<pre>
        use Mail::Toaster::Qmail;
        ConfigureQmailControl($conf);</pre>
<p>Installs the qmail control script as well as the startup (services.sh) script.</p>
<p>
</p>
<h2><a name="installqmailsuperviserunfiles">InstallQmailSuperviseRunFiles</a></h2>
<pre>
        use Mail::Toaster::Qmail;
        InstallQmailSuperviseRunFiles($conf, $supervise);</pre>
<p>$conf is a hashref of values pulled from toaster-watcher.conf. $supervise is your qmail supervise directory.</p>
<p>Generates the qmail/supervise/*/run files based on your settings.</p>
<p>
</p>
<h2><a name="installqmailsuperviselogrunfiles">InstallQmailSuperviseLogRunFiles</a></h2>
<pre>
        use Mail::Toaster::Qmail;
        InstallQmailSuperviseLogRunFiles($conf);</pre>
<p>$conf is a hash of values. See ParseConfigFile or toaster-watcher.conf for config values.</p>
<p>Installs the files the control your supervised processes logging. Typically this consists of qmail-smtpd, qmail-send, and qmail-pop3d. The generated files are:
</p>
<pre>

 $supervise/pop3/log/run
 $supervise/smtp/log/run
 $supervise/send/log/run</pre>
<p>
</p>
<h2><a name="getdomainsfromassign">GetDomainsFromAssign</a></h2>
<p>Fetch a list of domains from the qmaildir/users/assign file.</p>
<pre>
        use Mail::Toaster::Qmail;
        GetDomainsFromAssign($assign, $debug, $match, $value);</pre>
<pre>
 $assign is the path to the assign file.
 $debug is optional
 $match is an optional field to match (dom, uid, dir)
 $value is the pattern to  match</pre>
<p>
</p>
<hr />
<h1><a name="author">AUTHOR</a></h1>
<pre>
        Matt Simerson &lt;matt@cadillac.net&gt;</pre>
<p>
</p>
<hr />
<h1><a name="bugs">BUGS</a></h1>
<pre>
        None known. Report any to author.</pre>
<p>
</p>
<hr />
<h1><a name="todo">TODO</a></h1>
<p>
</p>
<hr />
<h1><a name="see_also">SEE ALSO</a></h1>
<p><a href="http://www.tnpi.biz/computing/">http://www.tnpi.biz/computing/</a>
<a href="http://www.tnpi.biz/internet/mail/toaster/">http://www.tnpi.biz/internet/mail/toaster/</a></p>
<p>Mail::Toaster::CGI, Mail::Toaster::DNS, Mail::Toaster::Logs,
Mail::Toaster::Qmail, Mail::Toaster::Setup

</p>
<p>
</p>
<hr />
<h1><a name="copyright">COPYRIGHT</a></h1>
<p>Copyright 2003, The Network People, Inc. All Rights Reserved.

</p>

</body>

</html>
