<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Mail::Toaster::Logs</title>
<link rev="made" href="mailto:root@hampsten.nonet" />
</head>

<body style="background-color: white">

<p><a name="__index__"></a></p>
<!-- INDEX BEGIN -->

<ul>

	<li><a href="#name">NAME</a></li>
	<li><a href="#synopsis">SYNOPSIS</a></li>
	<li><a href="#methods">METHODS</a></li>
	<ul>

		<li><a href="#new">new</a></li>
		<li><a href="#reportyesterday">ReportYesterday</a></li>
		<li><a href="#checksetup">CheckSetup</a></li>
		<li><a href="#checkforflags">CheckForFlags</a></li>
		<li><a href="#rbl_count">rbl_count</a></li>
		<li><a href="#smtp_count">smtp_count</a></li>
		<li><a href="#send_count">send_count</a></li>
		<li><a href="#imap_count">imap_count</a></li>
		<li><a href="#pop3_count">pop3_count</a></li>
		<li><a href="#webmail_count">webmail_count</a></li>
		<li><a href="#spama_count">spama_count</a></li>
		<li><a href="#qms_count">qms_count</a></li>
		<li><a href="#rollsendlogs">RollSendLogs</a></li>
		<li><a href="#rollrbllogs">RollRblLogs</a></li>
		<li><a href="#rollpop3logs">RollPOP3Logs</a></li>
		<li><a href="#compressyesterdayslogfile">CompressYesterdaysLogfile</a></li>
		<li><a href="#purgelastmonthlogs">PurgeLastMonthLogs</a></li>
		<li><a href="#rotatemaillogs">RotateMailLogs</a></li>
		<li><a href="#setupdatevariables">SetupDateVariables</a></li>
		<li><a href="#checklogfiles">CheckLogFiles</a></li>
		<li><a href="#processpop3logs">ProcessPOP3Logs</a></li>
		<li><a href="#processrbllogs">ProcessRblLogs</a></li>
		<li><a href="#countrblline">CountRblLine</a></li>
		<li><a href="#processsendlogs">ProcessSendLogs</a></li>
		<li><a href="#countsendline">CountSendLine</a></li>
		<li><a href="#counter_read">counter_read</a></li>
		<li><a href="#counter_write">counter_write</a></li>
		<li><a href="#what_am_i">what_am_i</a></li>
		<li><a href="#syslog_locate">syslog_locate</a></li>
	</ul>

	<li><a href="#design_considerations">Design considerations</a></li>
	<li><a href="#author">AUTHOR</a></li>
	<li><a href="#bugs">BUGS</a></li>
	<li><a href="#see_also">SEE ALSO</a></li>
	<li><a href="#copyright">COPYRIGHT</a></li>
</ul>
<!-- INDEX END -->

<hr />
<p>
</p>
<h1><a name="name">NAME</a></h1>
<p>Mail::Toaster::Logs</p>
<p>
</p>
<hr />
<h1><a name="synopsis">SYNOPSIS</a></h1>
<p>Perl modules related to mail logging. These modules are used primarily in maillogs but may be used in toaster-watcher.pl and toaster_setup.pl as well.</p>
<p>
</p>
<hr />
<h1><a name="methods">METHODS</a></h1>
<p>
</p>
<h2><a name="new">new</a></h2>
<p>Create a new Mail::Toaster::Logs object.</p>
<pre>
    use Mail::Toaster::Logs;
    $logs = Mail::Toaster::Logs-&gt;new;</pre>
<p>
</p>
<h2><a name="reportyesterday">ReportYesterday</a></h2>
<p>email a report of yesterdays email traffic.</p>
<p>
</p>
<h2><a name="checksetup">CheckSetup</a></h2>
<p>Does some checks to make sure things are set up correctly.</p>
<pre>
    $logs-&gt;CheckSetup($conf);</pre>
<p>tests:</p>
<pre>
  logs base directory exists
  logs based owned by qmaill
  counters directory exists
  maillogs is installed</pre>
<p>
</p>
<h2><a name="checkforflags">CheckForFlags</a></h2>
<p>Do the appropriate things based on what argument is passed on the command line.</p>
<pre>
        $logs-&gt;CheckForFlags($conf, $prot, $debug);</pre>
<p>$conf is a hashref of configuration values, assumed to be pulled from toaster-watcher.conf.</p>
<p>$prot is the protocol we're supposed to work on.</p>
<p>
</p>
<h2><a name="rbl_count">rbl_count</a></h2>
<p>Count the number of connections we've blocked (via rblsmtpd) for each RBL that we use.</p>
<pre>
        $logs-&gt;rbl_count($conf, $debug);</pre>
<p>
</p>
<h2><a name="smtp_count">smtp_count</a></h2>
<pre>
        $logs-&gt;smtp_count($conf, $syslog);</pre>
<p>Count the number of times users authenticate via SMTP-AUTH to our qmail-smtpd daemon.</p>
<p>
</p>
<h2><a name="send_count">send_count</a></h2>
<pre>
        $logs-&gt;send_count($conf);</pre>
<p>Count the number of messages we deliver, and a whole mess of stats from qmail-send.</p>
<p>
</p>
<h2><a name="imap_count">imap_count</a></h2>
<pre>
        $logs-&gt;imap_count($conf, $syslog);</pre>
<p>Count the number of connections and successful authentications via IMAP and IMAP-SSL.</p>
<p>
</p>
<h2><a name="pop3_count">pop3_count</a></h2>
<pre>
        $logs-&gt;pop3_count($conf, $syslog);</pre>
<p>Count the number of connections and successful authentications via POP3 and POP3-SSL.</p>
<p>
</p>
<h2><a name="webmail_count">webmail_count</a></h2>
<pre>
        $logs-&gt;webmail_count($conf, $syslog);</pre>
<p>Count the number of webmail authentications.</p>
<p>
</p>
<h2><a name="spama_count">spama_count</a></h2>
<pre>
        $logs-&gt;spama_count($conf, $syslog);</pre>
<p>Count statistics logged by SpamAssassin.</p>
<p>
</p>
<h2><a name="qms_count">qms_count</a></h2>
<pre>
        $logs-&gt;qms_count($conf, $syslog);</pre>
<p>Count statistics logged by qmail scanner.</p>
<p>
</p>
<h2><a name="rollsendlogs">RollSendLogs</a></h2>
<pre>
        $logs-&gt;RollSendLogs($conf, $debug);</pre>
<p>Roll the qmail-send multilog logs. Update the maillogs counter.</p>
<p>
</p>
<h2><a name="rollrbllogs">RollRblLogs</a></h2>
<pre>
        $logs-&gt;RollRblLogs($conf, $debug);</pre>
<p>Roll the qmail-smtpd logs (without 2&gt;&amp;1 output generated by rblsmtpd).</p>
<p>
</p>
<h2><a name="rollpop3logs">RollPOP3Logs</a></h2>
<pre>
        $logs-&gt;RollPOP3Logs($conf);</pre>
<p>These logs will only exist if tcpserver debugging is enabled. Rolling them is not likely to be necessary but the code is here should it ever prove necessary.</p>
<p>
</p>
<h2><a name="compressyesterdayslogfile">CompressYesterdaysLogfile</a></h2>
<pre>
        CompressYesterdaysLogfile($conf, $file, $debug);</pre>
<p>You'll have to guess what this does. ;)</p>
<p>
</p>
<h2><a name="purgelastmonthlogs">PurgeLastMonthLogs</a></h2>
<pre>
        PurgeLastMonthLogs($conf, $protdir, $debug);</pre>
<p>Keep guessing...</p>
<p>
</p>
<h2><a name="rotatemaillogs">RotateMailLogs</a></h2>
<pre>
        RotateMailLogs(@dirs);</pre>
<p>Tell multilog to rotate the maillogs for the array of dirs supplied.</p>
<p>
</p>
<h2><a name="setupdatevariables">SetupDateVariables</a></h2>
<pre>
        SetupDateVariables($offset);</pre>
<p>
</p>
<h2><a name="checklogfiles">CheckLogFiles</a></h2>
<pre>
        CheckLogFiles(@check);</pre>
<p>
</p>
<h2><a name="processpop3logs">ProcessPOP3Logs</a></h2>
<p>
</p>
<h2><a name="processrbllogs">ProcessRblLogs</a></h2>
<p>
</p>
<h2><a name="countrblline">CountRblLine</a></h2>
<p>
</p>
<h2><a name="processsendlogs">ProcessSendLogs</a></h2>
<p>
</p>
<h2><a name="countsendline">CountSendLine</a></h2>
<p>
</p>
<h2><a name="counter_read">counter_read</a></h2>
<pre>
        $logs-&gt;counter_read($file, $debug);</pre>
<p>$file is the file to read from. $debug is optional, it prints out verbose messages during the process. The sub returns a hashref full of key value pairs.</p>
<p>
</p>
<h2><a name="counter_write">counter_write</a></h2>
<pre>
        $logs-&gt;counter_write($file, %values);</pre>
<p>$file is the logfile to write to.</p>
<p>%values is a hash of value=count style pairs.</p>
<p>returns 1 if writable, 0 if not.</p>
<p>
</p>
<h2><a name="what_am_i">what_am_i</a></h2>
<pre>
        $logs-&gt;what_am_i(;$debug)</pre>
<p>Determine what the filename of this program is. This is used in maillogs, as maillogs gets renamed in order to function as a log post-processor for multilog.</p>
<p>
</p>
<h2><a name="syslog_locate">syslog_locate</a></h2>
<pre>
        $logs-&gt;syslog_locate($debug);</pre>
<p>Determine where syslog.mail is logged to. Right now we just test based on the OS you're running on and assume you've left it in the default location. This is easy to expand later.</p>
<p>
</p>
<hr />
<h1><a name="design_considerations">Design considerations</a></h1>
<ul>
<li><strong><a name="item_counters_will_be_polled_via_snmp_2e_script_must_be">Counters will be polled via SNMP. Script must be able to return counts instantly, even when dealing with HUGE logs.</a></strong><br />
</li>
<li><strong><a name="item_must_work_with_multilog_and_syslog_logging_formats">Must work with multilog and syslog logging formats</a></strong><br />
</li>
<li><strong><a name="item_outputs_data_in_a_format_suitable_for_polling_via_">Outputs data in a format suitable for polling via SNMP</a></strong><br />
</li>
<li><strong><a name="item_simple_configuration">Simple configuration</a></strong><br />
</li>
<li><strong><a name="item_fail_safe_2c_errors_must_be_noticed_and_reported_b">Fail safe, errors must be noticed and reported but not fatal</a></strong><br />
</li>
</ul>
<p>
</p>
<hr />
<h1><a name="author">AUTHOR</a></h1>
<p>Matt Simerson &lt;<a href="mailto:matt@tnpi.biz">matt@tnpi.biz</a>&gt;</p>
<p>
</p>
<hr />
<h1><a name="bugs">BUGS</a></h1>
<p>None known. Report any to author.</p>
<p>
</p>
<hr />
<h1><a name="see_also">SEE ALSO</a></h1>
<p><a href="http://www.tnpi.biz/internet/mail/toaster/">http://www.tnpi.biz/internet/mail/toaster/</a></p>
<p>Mail::Toaster::CGI, Mail::Toaster::DNS, Mail::Toaster::Logs,
Mail::Toaster::Qmail, Mail::Toaster::Setup</p>
<p>
</p>
<hr />
<h1><a name="copyright">COPYRIGHT</a></h1>
<p>Copyright (c) 2004, The Network People, Inc.
All rights reserved.</p>
<p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</p>
<p>Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</p>
<p>Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</p>
<p>Neither the name of the The Network People, Inc. nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</p>
<p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>

</body>

</html>
