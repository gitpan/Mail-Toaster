<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Mail::Toaster::Provision</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:root@omen.apple.com" />
</head>

<body style="background-color: white">

<p><a name="__index__"></a></p>
<!-- INDEX BEGIN -->

<ul>

	<li><a href="#name">NAME</a></li>
	<li><a href="#synopsis">SYNOPSIS</a></li>
	<li><a href="#description">DESCRIPTION</a></li>
	<li><a href="#dependencies">DEPENDENCIES</a></li>
	<li><a href="#methods">METHODS</a></li>
	<li><a href="#author">AUTHOR</a></li>
	<li><a href="#bugs">BUGS</a></li>
	<li><a href="#todo">TODO</a></li>
	<li><a href="#see_also">SEE ALSO</a></li>
	<li><a href="#copyright">COPYRIGHT</a></li>
</ul>
<!-- INDEX END -->

<hr />
<p>
</p>
<h1><a name="name">NAME</a></h1>
<p>Mail::Toaster::Provision - a rudimentary provisioning agent</p>
<p>
</p>
<hr />
<h1><a name="synopsis">SYNOPSIS</a></h1>
<p>Account provisioning methods. Not terribly complete, only the ones I use regularly have been coded.</p>
<p>
</p>
<hr />
<h1><a name="description">DESCRIPTION</a></h1>
<p>A suite of methods for provisioning various account types on unix like systems (Mac OS X, *BSD, Linux). Builds system accounts (/etc/passwd), web hosting accounts, mail hosting accounts, and DNS hosting accounts.</p>
<p>
</p>
<hr />
<h1><a name="dependencies">DEPENDENCIES</a></h1>
<pre>
 Quota         (/usr/ports/sysutils/p5-Quota)</pre>
<p>
</p>
<hr />
<h1><a name="methods">METHODS</a></h1>
<dl>
<dt><strong><a name="item_new">new</a></strong>

<dd>
<p>To use the following methods, you must first create a provision object. Then invoke any of the methods that follow using your provision object.</p>
</dd>
<dd>
<pre>
  use Mail::Toaster::Provision;
  my $prov = Mail::Toaster::Provision-&gt;new();</pre>
</dd>
<dd>
<pre>
  use Mail::Toaster::Utility;
  my $utility = Mail::Toaster::Utility-&gt;new();</pre>
</dd>
<dd>
<pre>
  my $conf = $utility-&gt;parse_config( file=&gt;&quot;sysadmin.conf&quot; );
  $prov-&gt;example_method( val=&gt;$vals, conf=&gt;$conf );</pre>
</dd>
<dd>
<pre>
 arguments required:
    conf - a hashref of values pulled from sysadmin.conf.</pre>
</dd>
</li>
<dt><strong><a name="item_dns">dns</a></strong>

<dd>
<p>dns will provision a DNS account using the programming API of a NicTool DNS server.</p>
</dd>
<dd>
<p>it is not completed.</p>
</dd>
</li>
<dt><strong><a name="item_quota_set">quota_set</a></strong>

<dd>
<p>Sets a user file system quota.</p>
</dd>
<dd>
<pre>
   $prov-&gt;quota_set( conf=&gt;$conf, user=&gt;&quot;bob&quot;, quota=&gt;200 );</pre>
</dd>
<dd>
<p>quota is set in megabytes. A hard limit will be set 5 megs larger than the soft limit.</p>
</dd>
<dd>
<pre>
 Dependencies:
   Quota (the perl module)</pre>
</dd>
<dd>
<pre>
 arguments required:
    user -  the system username to modify</pre>
</dd>
<dd>
<pre>
 arguments optional:
    quota - (int) - the quota value in megabytes (100)</pre>
</dd>
</li>
<dt><strong><a name="item_user">user</a></strong>

<dd>
<pre>
  $prov-&gt;user( action=&gt;'add', conf=&gt;$conf )</pre>
</dd>
<dd>
<pre>
        'action'  =&gt; $ARGV[0],
        'debug'   =&gt; $opt_v,</pre>
</dd>
<dd>
<p>user will call several private methods, beginning with user_get_options which collects the details for the new account from the command line (via GetOpts) or via a HTTP form method. Once the options are gathered, it will perform the requested action (create, destroy, disable, enable, show, repair, or test) on the account.</p>
</dd>
<dd>
<p>Due to ancient bugs corrupting FreeBSD's passwd files, user is very fault tolerant. It makes backup copies of the master.passwd files before altering them and tests to make sure the alterations it made are sane. If something is screwy, it saves a date stamped backup of the file.</p>
</dd>
<dd>
<p>It also sets user quotas if quota is passed.</p>
</dd>
<dd>
<pre>
 arguments required:
    user -</pre>
</dd>
<dd>
<pre>
 arguments optional:
    conf -</pre>
</dd>
<dd>
<pre>
 result:</pre>
</dd>
<dt><strong><a name="item_user_usage">user_usage</a></strong>

<dd>
<p>returns the following message if improper or missing arguments are passed:</p>
</dd>
<dd>
<pre>
        useradmin action username</pre>
</dd>
<dd>
<pre>
    required values:</pre>
</dd>
<dd>
<pre>
       -username</pre>
</dd>
<dd>
<pre>
    optional values:</pre>
</dd>
<dd>
<pre>
       -password
       -shell
       -homedir
       -comment
       -quota
       -uid
       -gid
       -expire date
       -domain</pre>
</dd>
<dd>
<p>If domain is set, then tit's assumed that you're setting up a web hosted account and you want the home directory to be /home/domain.com instead of /home/user. This integrates quite nicely with Apache's mass virtual hosting.</p>
</dd>
</li>
<dt><strong><a name="item_user_options">user_options</a></strong>

<dd>
<p>Collects the options required for setting up a user account from the command line (GetOpts) or from a HTTP form submission.</p>
</dd>
</li>
<dt><strong><a name="item_usage_action">usage_action</a></strong>

<dd>
<p>return the following message:</p>
</dd>
<dd>
<pre>
  usage $0 action [params]</pre>
</dd>
<dd>
<pre>
        action is one of:</pre>
</dd>
<dd>
<pre>
       create  - adding users, domains, etc
       destroy - permanently removing objects</pre>
</dd>
<dd>
<pre>
       disable - temporarily disable
       enable  - restore disabled objects</pre>
</dd>
<dd>
<pre>
       show    - show current objects and settings</pre>
</dd>
<dd>
<pre>
       repair  - misc repair options
       test    - test settings</pre>
</dd>
</li>
<dt><strong><a name="item_web">web</a></strong>

<dd>
<pre>
        $prov-&gt;web (vals=&gt;$vals, conf=&gt;$conf)</pre>
</dd>
<dd>
<p>$vals is a hashref of values</p>
</dd>
<dd>
<pre>
        my $vals = { 
                'action'  =&gt; $ARGV[0],
                'debug'   =&gt; $opt_v,
        };</pre>
</dd>
<dd>
<p>web will call several private methods, beginning with web_get_options which collects the details for the new account from the command line (via GetOpts) or via a HTTP form method. Once the options are gathered, it will perform the requested action (create, destroy, disable, enable, show, repair, or test) on the account.</p>
</dd>
<dt><strong><a name="item_web_check_setup">web_check_setup</a></strong>

<dd>
<p>Performs various tests on the apache config settings:</p>
</dd>
<dd>
<pre>
 make sure apache conf dir exists
 make sure vhost config is set up</pre>
</dd>
</li>
<dt><strong><a name="item_web_usage">web_usage</a></strong>

<dd>
<p>returns the following message if improper or missing arguments are passed:</p>
</dd>
<dd>
<pre>
        webadmin action -vhost [vhost name]</pre>
</dd>
<dd>
<pre>
    required values:</pre>
</dd>
<dd>
<pre>
       -vhost</pre>
</dd>
<dd>
<pre>
    optional values:</pre>
</dd>
<dd>
<pre>
       -ip             - IP address to listen on (default *)
       -serveralias    - comma separated list of aliases
       -serveradmin    - email of server admin
       -documentroot   - path to html files
       -redirect       - url to redirect site to
       -options        - server options ex. FollowSymLinks MultiViews Indexes ExecCGI Includes
       -ssl            - ssl enabled ? 
       -sslcert        - path to ssl certificate
       -sslkey         - path to ssl key
       -cgi            - basic | advanced | custom
       -customlog      - custom logging directive
       -customerror    - custom error logging directive</pre>
</dd>
<dd>
<pre>
       -awstats        - include alias for awstats
       -phpmyadmin     - include alias for php</pre>
</dd>
</li>
<dt><strong><a name="item_web_get_options">web_get_options</a></strong>

<dd>
<p>Collects web account settings from the command line arguments or a HTML form.</p>
</dd>
</li>
<dt><strong><a name="item_what_am_i">what_am_i</a></strong>

<dd>
<pre>
        $prov-&gt;what_am_i()</pre>
</dd>
<dd>
<p>Determine what the filename of this program is.</p>
</dd>
<dt><strong><a name="item_what_am_i_check">what_am_i_check</a></strong>

<dd>
<p>To simplify usage and increase the ability to secure access to various features, the program determines how it's being called. Currently, there are 4 options:</p>
</dd>
<dd>
<pre>
  dnsadmin
  mailadmin
  useradmin
  webadmin</pre>
</dd>
<dd>
<p>This simply checks to make sure a valid one has been invoked.</p>
</dd>
</li>
</dl>
<p>
</p>
<hr />
<h1><a name="author">AUTHOR</a></h1>
<p>Matt Simerson &lt;<a href="mailto:matt@tnpi.net">matt@tnpi.net</a>&gt;</p>
<p>
</p>
<hr />
<h1><a name="bugs">BUGS</a></h1>
<p>None known. Report any to author.</p>
<p>
</p>
<hr />
<h1><a name="todo">TODO</a></h1>
<p>
</p>
<hr />
<h1><a name="see_also">SEE ALSO</a></h1>
<p>The following are all man/perldoc pages:</p>
<pre>
 Mail::Toaster 
 Mail::Toaster::Conf
 toaster.conf
 toaster-watcher.conf</pre>
<pre>
 <a href="http://mail-toaster.org/">http://mail-toaster.org/</a></pre>
<p>
</p>
<hr />
<h1><a name="copyright">COPYRIGHT</a></h1>
<p>Copyright (c) 2004-2006, The Network People, Inc.  All rights reserved.</p>
<p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</p>
<p>Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</p>
<p>Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</p>
<p>Neither the name of the The Network People, Inc. nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</p>
<p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>

</body>

</html>
